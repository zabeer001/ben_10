<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <style>
      .bebas-neue-regular {
        font-family: "Bebas Neue", sans-serif;

        font-style: normal;
      }

      .active-btn {
        background-color: #bdeef8 !important;
        color: #006b80 !important;
      }

      .inactive-btn {
        background-color: transparent !important;
        color: #d6d6d6 !important;
      }

      /* Red line base styles */
      .red-line {
        background-color: #ed6b6b;
        height: 2px;
        margin-top: 8px;
        margin-bottom: 20px;
      }

      /* Desktop styles (default) */
      .post-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 120px;
        max-width: 1581px;
        margin: 0 auto;
      }

      .post-image {
        height: 394px;
        width: 691px;
      }

      .post-text {
        width: 561px;
      }

      .section-padding {
        padding: 144px 20px;
      }

      .category-buttons {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 40px;
        padding: 40px 20px;
        flex-wrap: wrap;
        border-radius: none;
      }

      #category-buttons {
        border-radius: none !important;
        font-family: "Outfit" !important;
      }

      /* Large Desktop */
      @media (min-width: 1400px) {
        .post-container {
          gap: 150px;
        }
      }

      /* MacBook Air / Medium Desktop (1366px and similar) */
      @media (max-width: 1400px) and (min-width: 1200px) {
        .post-container {
          gap: 100px;
          max-width: 1177.59px;
        }

        .post-image {
          width: 600px;
          height: 350px;
        }

        .post-text {
          width: 500px;
        }
      }

      /* Small Desktop / Large Laptop */
      @media (max-width: 1300px) {
        .post-container {
          gap: 80px;
        }

        .post-image {
          width: 550px;
          height: 320px;
        }

        .post-text {
          width: 450px;
        }
      }

      /* MacBook Air 13" and similar laptops */
      @media (max-width: 1200px) {
        .post-container {
          gap: 60px;
        }

        .post-image {
          width: 480px;
          height: 290px;
        }

        .post-text {
          width: 420px;
        }

        .section-padding {
          padding: 120px 20px;
        }
      }

      /* Small Laptop */
      @media (max-width: 1100px) {
        .post-container {
          gap: 50px;
        }

        .post-image {
          width: 450px;
          height: 280px;
        }

        .post-text {
          width: 400px;
        }

        .section-padding {
          padding: 100px 20px;
        }
      }

      /* Large Tablet */
      @media (max-width: 1000px) {
        .post-container {
          gap: 40px;
        }

        .post-image {
          width: 420px;
          height: 260px;
        }

        .post-text {
          width: 380px;
        }
      }

      /* Tablet */
      @media (max-width: 900px) {
        .post-container {
          flex-direction: column;
          gap: 40px;
          text-align: center;
        }

        .post-image {
          width: 100%;
          max-width: 600px;
          height: 300px;
        }

        .post-text {
          width: 100%;
          max-width: 600px;
        }

        .section-padding {
          padding: 80px 30px;
        }

        .category-buttons {
          gap: 20px;
          padding: 30px 20px;
        }

        .post-title {
          font-size: 28px !important;
        }

        .decorative-circle {
          display: none;
        }

        .decorative-vector {
          display: none;
        }

        .red-line {
          margin: 8px auto 20px auto;
        }
      }

      /* Mobile Large */
      @media (max-width: 768px) {
        .category-buttons {
          gap: 15px;
          padding: 25px 15px;
          justify-content: center;
        }

        .filter-btn {
          padding: 10px 16px !important;
          font-size: 14px !important;
          font-weight: 600 !important;
          border-radius: 4px;
          white-space: nowrap;
        }

        .post-image {
          height: 250px;
          max-width: 90vw;
        }

        .post-text {
          max-width: 90vw;
          padding: 0 15px;
        }

        .post-title {
          font-size: 24px !important;
          line-height: 1.3 !important;
          margin: 20px 0 15px 0 !important;
        }

        .post-excerpt {
          font-size: 16px !important;
          line-height: 1.5 !important;
        }

        .post-excerpt:hover {
            color: black !important;
        }


        .section-padding {
          padding: 60px 15px;
        }
        .section-padding:hover{
            color: black !important;
        }

        .category-name {
          font-size: 14px !important;
          margin-bottom: 5px !important;
        }

        .red-line {
          margin: 8px auto 20px auto;
        }
      }

      /* Mobile Medium */
      @media (max-width: 480px) {
        .category-buttons {
          gap: 10px;
          padding: 20px 10px;
        }

        .filter-btn {
          padding: 8px 12px !important;
          font-size: 12px !important;
        }

        .post-image {
          height: 220px;
        }

        .post-title {
          font-size: 20px !important;
        }

        .post-excerpt {
          font-size: 14px !important;
        }

        .section-padding {
          padding: 40px 10px;
        }

        .category-name {
          font-size: 12px !important;
        }

        .red-line {
          margin: 6px auto 18px auto;
        }
      }

      /* Mobile Small */
      @media (max-width: 360px) {
        .category-buttons {
          gap: 8px;
          padding: 15px 8px;
        }

        .filter-btn {
          padding: 6px 10px !important;
          font-size: 11px !important;
        }

        .post-image {
          height: 200px;
        }

        .post-title {
          font-size: 18px !important;
        }

        .post-excerpt {
          font-size: 13px !important;
        }

        .section-padding {
          padding: 30px 8px;
        }

        .red-line {
          margin: 6px auto 16px auto;
        }
      }
    </style>
  </head>

  <body>
    <main>
      <div id="category-buttons" class="category-buttons"></div>
      <section>
        <section id="post-container"></section>
      </section>
    </main>

    <script>
      // Prevent multiple executions of the script
      if (!window.hasLoadedCategories) {
        window.hasLoadedCategories = true;

        document.addEventListener("DOMContentLoaded", async () => {
          const btnContainer = document.getElementById("category-buttons");
          const postContainer = document.getElementById("post-container");
          const categoryURL = "https://thedcenter.com/wp-json/wp/v2/categories";

          // Clear existing buttons to prevent duplicates
          btnContainer.innerHTML = "";

          function calculateRedLineWidth(categoryName) {
            const baseWidth = categoryName.length * 8;
            const screenWidth = window.innerWidth;
            let multiplier = 1;
            if (screenWidth >= 1400) multiplier = 1.2;
            else if (screenWidth >= 1200) multiplier = 1.1;
            else if (screenWidth >= 1100) multiplier = 1.0;
            else if (screenWidth >= 1000) multiplier = 0.95;
            else if (screenWidth >= 900) multiplier = 0.9;
            else if (screenWidth >= 768) multiplier = 0.85;
            else if (screenWidth >= 480) multiplier = 0.8;
            else multiplier = 0.75;

            const calculatedWidth = Math.round(baseWidth * multiplier);
            const minWidth = 30;
            const maxWidth = screenWidth >= 900 ? 150 : 120;
            return Math.max(minWidth, Math.min(calculatedWidth, maxWidth));
          }

          function stripHTML(html) {
            const div = document.createElement("div");
            div.innerHTML = html;
            return div.textContent || div.innerText || "";
          }

          async function fetchImageUrl(mediaId) {
            try {
              const res = await fetch(
                `https://thedcenter.com/wp-json/wp/v2/media/${mediaId}`
              );
              const media = await res.json();
              return (
                media.source_url ||
                "https://via.placeholder.com/691x394.png?text=No+Image"
              );
            } catch {
              return "https://via.placeholder.com/691x394.png?text=No+Image";
            }
          }

          async function fetchPosts(postURL, categoryName) {
            try {
              const res = await fetch(postURL);
              const posts = await res.json();

              postContainer.innerHTML = "";

              if (!posts.length) {
                postContainer.innerHTML = `<p class='text-center py-10 text-gray-500'>No posts found.</p>`;
                return;
              }

              for (let index = 0; index < posts.length; index++) {
                const post = posts[index];
                const imageUrl = await fetchImageUrl(post.featured_media);
                const excerpt = stripHTML(post.excerpt.rendered).slice(0, 300);
                const isEven = index % 2 === 0;
                const categoryId = post.categories[0];
                const categoryNameForUrl = `https://thedcenter.com/wp-json/wp/v2/categories/${categoryId}`;
                let categoryName2 = "";

                try {
                  const categoryResponse = await fetch(categoryNameForUrl);
                  const categoryData = await categoryResponse.json();
                  categoryName2 = categoryData.name;
                } catch (err) {
                  console.error("Error fetching category name:", err);
                }
                const redLineWidth = calculateRedLineWidth(categoryName2);

                let html = "";

                if (isEven) {
                  html = `<a href="${post.link}" class="hover:!text-black">
                    <div class="bg-[#F7FDFF]">
                      <section class="section-padding">
                        <div class="post-container">
                          <div class="relative post-image z-10">
                            <div class="decorative-circle w-[60px] h-[60px] rounded-full bg-[#BDEEF8] absolute right-[-30px] top-[-30px] z-0"></div>
                            <div class="absolute inset-0 bg-red-400 z-10 flex items-center justify-center overflow-hidden">
                              <img src="${imageUrl}" alt="${post.title.rendered}" class="h-full w-full object-cover" />
                            </div>
                          </div>
                          <div class="post-text">
                            <p class="category-name !font-[Outfit]">${categoryName2}</p>
                            <div class="red-line" style="width: ${redLineWidth}px;"></div>
                            <h1
                            class="post-title mb-2
                                    text-[25px]      /* base: 14 + 5 */
                                    sm:text-[21px]   /* 16 + 5 */
                                    md:text-[23px]   /* 18 + 5 */
                                    lg:text-[40px]   /* 20 + 5 */
                                    xl:text-[40px]   /* 25 + 5 */
                                    bebas-neue-regular
                            "
                            >
    ${post.title.rendered}</h1>
                            <p class="post-excerpt !font-[Outfit] hover:!text-black">${excerpt}...</p>
                          </div>
                        </div>
                      </section>
                    </div>
                  </a>`;
                } else {
                  html = `<a href="${post.link}" class="hover:!text-black">
                    <div>
                      <section class="section-padding">
                        <div class="post-container">
                          <div class="post-text">
                            <p class="category-name !font-[Outfit]">${categoryName2}</p>
                            <div class="red-line" style="width: ${redLineWidth}px;"></div>
                            <h1
       class="post-title mb-2
             text-[25px]      /* base: 14 + 5 */
             sm:text-[21px]   /* 16 + 5 */
             md:text-[23px]   /* 18 + 5 */
             lg:text-[40px]   /* 20 + 5 */
             xl:text-[40px]   /* 25 + 5 */
            bebas-neue-regular
      "
    >
    ${post.title.rendered}</h1>
                            <p class="post-excerpt !font-[Outfit] hover:!text-black">${excerpt}...</p>
                          </div>
                          <div class="post-image relative z-20">
                            <img src="https://res.cloudinary.com/drdztqgcx/image/upload/v1748100232/vector_b3k5q1.png" alt="" class="decorative-vector absolute left-[-60px] top-[35px] w-[132px] h-[76px] z-0" />
                            <div class="absolute inset-0 bg-red-400 z-10 flex items-center justify-center overflow-hidden ">
                              <img src="${imageUrl}" alt="${post.title.rendered}" class="h-full w-full object-cover" />
                            </div>
                          </div>
                        </div>
                      </section>
                    </div>
                  </a>`;
                }

                postContainer.insertAdjacentHTML("beforeend", html);
              }
            } catch (error) {
              console.error("Error fetching posts:", error);
            }
          }

          function setActiveButton(clickedButton) {
            document.querySelectorAll(".filter-btn").forEach((btn) => {
              btn.classList.remove("active-btn");
              btn.classList.add("inactive-btn");
            });
            clickedButton.classList.add("active-btn");
            clickedButton.classList.remove("inactive-btn");
          }

          // Create "All Articles" button only if it doesn't exist
          if (!btnContainer.querySelector(".filter-btn[data-category='all']")) {
            const allBtn = document.createElement("button");
            allBtn.className =
              "filter-btn py-[12px] px-[18px] !font-[Outfit] text-base font-black leading-6 transition-all duration-200 active-btn !rounded-none";
            allBtn.innerText = "All Articles";
            allBtn.dataset.category = "all";
            btnContainer.appendChild(allBtn);

            allBtn.addEventListener("click", () => {
              setActiveButton(allBtn);
              fetchPosts(
                "https://thedcenter.com/wp-json/wp/v2/posts?per_page=10",
                "All Articles"
              );
            });
          }

          // Load "All Articles" by default
          fetchPosts(
            "https://thedcenter.com/wp-json/wp/v2/posts?per_page=10",
            "All Articles"
          );

          // Fetch categories and add their buttons
          try {
            const res = await fetch(categoryURL);
            const categories = await res.json();

            categories.forEach((category) => {
              if (category.name === "Uncategorized") {
                return;
              }
              // Check if button for this category already exists
              if (
                !btnContainer.querySelector(
                  `.filter-btn[data-category='${category.id}']`
                )
              ) {
                const btn = document.createElement("button");
                btn.className =
                  "filter-btn py-[12px] px-[18px] !font-[Outfit] text-base font-black leading-6 transition-all duration-200 inactive-btn !rounded-none";
                btn.innerText = category.name;
                btn.dataset.category = category.id;
                btn.addEventListener("click", () => {
                  setActiveButton(btn);
                  fetchPosts(
                    `https://thedcenter.com/wp-json/wp/v2/posts?categories=${category.id}&per_page=10`,
                    category.name
                  );
                });
                btnContainer.appendChild(btn);
              }
            });
          } catch (err) {
            console.error("Failed to load categories", err);
          }

          window.addEventListener("resize", () => {
            const redLines = document.querySelectorAll(".red-line");
            redLines.forEach((line) => {
              const categoryElement = line.previousElementSibling;
              if (categoryElement && categoryElement.textContent) {
                const newWidth = calculateRedLineWidth(
                  categoryElement.textContent
                );
                line.style.width = `${newWidth}px`;
              }
            });
          });
        });
      }
      let categorybuttons = document.querySelectorAll(
        "#category-buttons .filter-btn"
      );
      console.log("hello");

      console.log(categorybuttons);
    </script>

    <script>
      window.onload = function () {
        setTimeout(() => {
          let categorybuttons = document.querySelectorAll(
            "#category-buttons .filter-btn"
          );

          categorybuttons.forEach((button) => {
            if (!button.hasAttribute("data-category")) {
              button.remove();
            }
          });

          console.log(
            "Filtered buttons:",
            document.querySelectorAll("#category-buttons .filter-btn")
          );
        }, 2000);
      };

      let batpar_class = document.querySelectorAll(".e-con-inner");
      if (batpar_class[3]) {
        // Remove all CSS classes
        batpar_class[3].classList.remove(...batpar_class[3].classList);

        // Remove all inline styles
        batpar_class[3].removeAttribute("style");
      }
    </script>
  </body>
</html>
